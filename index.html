<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>C3 Shader Graph</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="app">
      <div id="toolbar">
        <div class="toolbar-section toolbar-branding">
          <h1>Construct 3 Shader Graph</h1>
        </div>
        <div class="toolbar-section toolbar-actions">
          <button id="newBtn" class="toolbar-btn" title="New File (Ctrl+N)">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path
                d="M13,9V3.5L18.5,9M6,2C4.89,2 4,2.89 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6Z"
              />
            </svg>
            <span>New</span>
          </button>
          <button id="loadBtn" class="toolbar-btn" title="Open File (Ctrl+O)">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path
                d="M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z"
              />
            </svg>
            <span>Open</span>
          </button>
          <button id="saveBtn" class="toolbar-btn" title="Save (Ctrl+S)">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path
                d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"
              />
            </svg>
            <span>Save</span>
          </button>
          <button
            id="saveAsBtn"
            class="toolbar-btn"
            title="Save As (Ctrl+Shift+S)"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path
                d="M17 3H5C3.89 3 3 3.9 3 5V19C3 20.11 3.9 21 5 21H12.81C12.45 20.38 12.2 19.7 12.08 19L12 19C10.34 19 9 17.66 9 16S10.34 13 12 13C12.68 13 13.34 13.23 13.87 13.65C15 12.59 16.46 12 18 12C19.05 12 20.09 12.28 21 12.81V7L17 3M15 9H5V5H15V9M17 14V17H14V19H17V22H19V19H22V17H19V14H17Z"
              />
            </svg>
            <span>Save As</span>
          </button>
          <div class="toolbar-separator"></div>
          <button id="undoBtn" class="toolbar-btn" title="Undo (Ctrl+Z)">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path
                d="M12.5,8C9.85,8 7.45,9 5.6,10.6L2,7V16H11L7.38,12.38C8.77,11.22 10.54,10.5 12.5,10.5C16.04,10.5 19.05,12.81 20.1,16L22.47,15.22C21.08,11.03 17.15,8 12.5,8Z"
              />
            </svg>
            <span>Undo</span>
          </button>
          <button id="redoBtn" class="toolbar-btn" title="Redo (Ctrl+Y)">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path
                d="M18.4,10.6C16.55,9 14.15,8 11.5,8C6.85,8 2.92,11.03 1.54,15.22L3.9,16C4.95,12.81 7.95,10.5 11.5,10.5C13.45,10.5 15.23,11.22 16.62,12.38L13,16H22V7L18.4,10.6Z"
              />
            </svg>
            <span>Redo</span>
          </button>
          <div class="toolbar-separator"></div>
          <button
            id="autoArrangeBtn"
            class="toolbar-btn"
            title="Auto Arrange Nodes (Ctrl+L)"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path
                d="M3,11H11V3H3M3,21H11V13H3M13,21H21V13H13M13,3V11H21V3M5,5H9V9H5M15,15H19V19H15M15,5H19V9H15M5,15H9V19H5Z"
              />
            </svg>
            <span>Auto Arrange</span>
          </button>
          <button
            id="debugArrangeBtn"
            class="toolbar-btn"
            title="Debug Auto Arrange (Step-by-Step)"
            style="display: none"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path
                d="M11,4H13V6H11V4M13,7H11V9H13V7M13,10H11V12H13V10M9,2V7H8V13H16V7H15V2H9M12,14A6,6 0 0,0 6,20A6,6 0 0,0 12,26A6,6 0 0,0 18,20A6,6 0 0,0 12,14M12,16A4,4 0 0,1 16,20A4,4 0 0,1 12,24A4,4 0 0,1 8,20A4,4 0 0,1 12,16M11,17V21H13V17H11Z"
              />
            </svg>
            <span>Debug Arrange</span>
          </button>
          <button
            id="viewCodeBtn"
            class="toolbar-btn"
            title="View Generated Code"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path
                d="M14.6,16.6L19.2,12L14.6,7.4L16,6L22,12L16,18L14.6,16.6M9.4,16.6L4.8,12L9.4,7.4L8,6L2,12L8,18L9.4,16.6Z"
              />
            </svg>
            <span>View Code</span>
          </button>
          <button
            id="exportBtn"
            class="toolbar-btn toolbar-btn-primary"
            title="Export Addon"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path
                d="M23,12L19,8V11H10V13H19V16M1,18V6C1,4.89 1.9,4 3,4H15A2,2 0 0,1 17,6V9H15V6H3V18H15V15H17V18A2,2 0 0,1 15,20H3A2,2 0 0,1 1,18Z"
              />
            </svg>
            <span>Export</span>
          </button>
          <div class="toolbar-separator"></div>
          <button
            id="reportIssueBtn"
            class="toolbar-btn toolbar-btn-secondary"
            title="Report an Issue on GitHub"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path
                d="M14,12H10V10H14M14,16H10V14H14M20,8H17.19C16.74,7.22 16.12,6.55 15.37,6.04L17,4.41L15.59,3L13.42,5.17C12.96,5.06 12.5,5 12,5C11.5,5 11.04,5.06 10.59,5.17L8.41,3L7,4.41L8.62,6.04C7.88,6.55 7.26,7.22 6.81,8H4V10H6.09C6.04,10.33 6,10.66 6,11V12H4V14H6V15C6,15.34 6.04,15.67 6.09,16H4V18H6.81C7.85,19.79 9.78,21 12,21C14.22,21 16.15,19.79 17.19,18H20V16H17.91C17.96,15.67 18,15.34 18,15V14H20V12H18V11C18,10.66 17.96,10.33 17.91,10H20V8Z"
              />
            </svg>
            <span>Report Issue</span>
          </button>
          <button
            id="githubBtn"
            class="toolbar-btn toolbar-btn-icon"
            title="View on GitHub"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path
                d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z"
              />
            </svg>
          </button>
        </div>
      </div>
      <input
        type="file"
        id="loadFileInput"
        accept=".c3sg,.json"
        style="display: none"
      />
      <div id="main-content">
        <div id="shader-errors-container"></div>
        <button id="openPreviewBtn" title="Open Preview" style="display: none">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <title>eye</title>
            <path
              d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"
            />
          </svg>
        </button>
        <div id="preview-window">
          <div id="preview-header">
            <span>Preview</span>
            <div class="preview-header-buttons">
              <button id="togglePreviewSettingsBtn" title="Toggle Settings">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <title>tune-variant</title>
                  <path
                    d="M8 13C6.14 13 4.59 14.28 4.14 16H2V18H4.14C4.59 19.72 6.14 21 8 21S11.41 19.72 11.86 18H22V16H11.86C11.41 14.28 9.86 13 8 13M8 19C6.9 19 6 18.1 6 17C6 15.9 6.9 15 8 15S10 15.9 10 17C10 18.1 9.1 19 8 19M19.86 6C19.41 4.28 17.86 3 16 3S12.59 4.28 12.14 6H2V8H12.14C12.59 9.72 14.14 11 16 11S19.41 9.72 19.86 8H22V6H19.86M16 9C14.9 9 14 8.1 14 7C14 5.9 14.9 5 16 5S18 5.9 18 7C18 8.1 17.1 9 16 9Z"
                  />
                </svg>
              </button>
              <button id="reloadPreviewBtn" title="Reload Preview">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <title>refresh</title>
                  <path
                    d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"
                  />
                </svg>
              </button>
              <button id="closePreviewBtn" title="Close Preview">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <title>window-close</title>
                  <path
                    d="M13.46,12L19,17.54V19H17.54L12,13.46L6.46,19H5V17.54L10.54,12L5,6.46V5H6.46L12,10.54L17.54,5H19V6.46L13.46,12Z"
                  />
                </svg>
              </button>
            </div>
          </div>
          <div id="preview-content">
            <div id="preview-controls" class="preview-controls-hidden">
              <div class="preview-control-group">
                <label>Effect Target:</label>
                <select id="effectTargetSelect">
                  <option value="sprite">Sprite</option>
                  <option value="shape3D">3D Shape</option>
                  <option value="layout">Layout</option>
                  <option value="layer">Layer</option>
                </select>
              </div>
              <div class="preview-control-group">
                <label>Object:</label>
                <select id="objectSelect">
                  <option value="sprite">Sprite</option>
                  <option value="box">Box</option>
                  <option value="prism">Prism</option>
                  <option value="wedge">Wedge</option>
                  <option value="pyramid">Pyramid</option>
                  <option value="corner-out">Corner Out</option>
                  <option value="corner-in">Corner In</option>
                </select>
              </div>
              <div class="preview-control-group">
                <label>Camera:</label>
                <select id="cameraModeSelect">
                  <option value="2d">2D</option>
                  <option value="perspective">Perspective</option>
                  <option value="orthographic">Orthographic</option>
                </select>
              </div>
              <div class="preview-control-group" id="autoRotateGroup">
                <label>
                  <input type="checkbox" id="autoRotateCheckbox" checked />
                  Auto Rotate
                </label>
              </div>
              <div class="preview-control-group">
                <label>Sampling:</label>
                <select id="samplingModeSelect">
                  <option value="trilinear">Trilinear</option>
                  <option value="bilinear">Bilinear</option>
                  <option value="nearest">Nearest</option>
                </select>
              </div>
              <div class="preview-control-group">
                <label>Shader Language:</label>
                <select id="shaderLanguageSelect">
                  <option value="webgpu">WebGPU</option>
                  <option value="webgl2">WebGL 2</option>
                  <option value="webgl1">WebGL 1</option>
                </select>
              </div>
              <div class="preview-control-group preview-texture-group">
                <label>Sprite Texture:</label>
                <div class="texture-preview-container">
                  <div id="spriteTexturePreview" class="texture-preview">
                    <span>No image</span>
                  </div>
                  <input
                    type="file"
                    id="spriteTextureInput"
                    accept="image/*"
                    style="display: none"
                  />
                  <button
                    id="spriteTextureBtn"
                    class="texture-btn"
                    title="Load sprite texture"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                      <path
                        d="M5 3H19C20.11 3 21 3.9 21 5V19C21 20.11 20.11 21 19 21H5C3.9 21 3 20.11 3 19V5C3 3.9 3.9 3 5 3M16 17V15H8V17H16M16 11L12 7L8 11H10.5V14H13.5V11H16Z"
                      />
                    </svg>
                  </button>
                  <button
                    id="clearSpriteTextureBtn"
                    class="texture-clear-btn"
                    title="Clear sprite texture"
                    style="display: none"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                      <path
                        d="M22,3H7C6.31,3 5.77,3.35 5.41,3.88L0,12L5.41,20.11C5.77,20.64 6.31,21 7,21H22A2,2 0 0,0 24,19V5A2,2 0 0,0 22,3M19,15.59L17.59,17L14,13.41L10.41,17L9,15.59L12.59,12L9,8.41L10.41,7L14,10.59L17.59,7L19,8.41L15.41,12"
                      />
                    </svg>
                  </button>
                </div>
              </div>
              <div class="preview-control-group preview-texture-group">
                <label>Shape Texture:</label>
                <div class="texture-preview-container">
                  <div id="shapeTexturePreview" class="texture-preview">
                    <span>No image</span>
                  </div>
                  <input
                    type="file"
                    id="shapeTextureInput"
                    accept="image/*"
                    style="display: none"
                  />
                  <button
                    id="shapeTextureBtn"
                    class="texture-btn"
                    title="Load shape texture"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                      <path
                        d="M5 3H19C20.11 3 21 3.9 21 5V19C21 20.11 20.11 21 19 21H5C3.9 21 3 20.11 3 19V5C3 3.9 3.9 3 5 3M16 17V15H8V17H16M16 11L12 7L8 11H10.5V14H13.5V11H16Z"
                      />
                    </svg>
                  </button>
                  <button
                    id="clearShapeTextureBtn"
                    class="texture-clear-btn"
                    title="Clear shape texture"
                    style="display: none"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                      <path
                        d="M22,3H7C6.31,3 5.77,3.35 5.41,3.88L0,12L5.41,20.11C5.77,20.64 6.31,21 7,21H22A2,2 0 0,0 24,19V5A2,2 0 0,0 22,3M19,15.59L17.59,17L14,13.41L10.41,17L9,15.59L12.59,12L9,8.41L10.41,7L14,10.59L17.59,7L19,8.41L15.41,12"
                      />
                    </svg>
                  </button>
                </div>
              </div>
              <div class="preview-control-group">
                <button id="resetPreviewSettingsBtn" class="reset-preview-btn">
                  Reset Preview Settings
                </button>
              </div>
            </div>
            <iframe id="preview-iframe" src="./preview/index.html"></iframe>
          </div>
        </div>
        <div id="uniform-sidebar">
          <div id="shader-settings-section" class="collapsible-section">
            <div class="sidebar-section-header">
              <h2>Shader Info</h2>
              <button class="collapse-btn">▼</button>
            </div>
            <div class="sidebar-section-content">
              <div class="settings-form">
                <label>
                  <span>Name</span>
                  <input type="text" id="settingName" placeholder="My Effect" />
                </label>
                <label>
                  <span>Version</span>
                  <input
                    type="text"
                    id="settingVersion"
                    placeholder="1.0.0.0"
                  />
                </label>
                <label>
                  <span>Author</span>
                  <input
                    type="text"
                    id="settingAuthor"
                    placeholder="Author name"
                  />
                </label>

                <label>
                  <span>Category</span>
                  <select id="settingCategory">
                    <option value="3d">3D</option>
                    <option value="blend">Blend</option>
                    <option value="color" selected>Color</option>
                    <option value="distortion">Distortion</option>
                    <option value="mask">Mask</option>
                    <option value="normal-mapping">Normal Mapping</option>
                    <option value="tiling">Tiling</option>
                    <option value="other">Other</option>
                  </select>
                </label>
                <label>
                  <span>Website</span>
                  <input
                    type="url"
                    id="settingWebsite"
                    placeholder="https://example.com"
                  />
                </label>
                <label>
                  <span>Docs</span>
                  <input
                    type="url"
                    id="settingDocumentation"
                    placeholder="https://docs.example.com"
                  />
                </label>
                <label>
                  <span>Description</span>
                  <textarea
                    id="settingDescription"
                    rows="3"
                    placeholder="Shader description..."
                  ></textarea>
                </label>
              </div>
            </div>
          </div>
          <div id="shader-settings-section" class="collapsible-section">
            <div class="sidebar-section-header">
              <h2>Shader Settings</h2>
              <button class="collapse-btn">▼</button>
            </div>
            <div class="sidebar-section-content">
              <div class="settings-form">
                <label class="checkbox-label">
                  <input type="checkbox" id="settingBlendsBackground" />
                  <span>Blends Background</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="settingCrossSampling" />
                  <span>Cross Sampling</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="settingPreservesOpaqueness" />
                  <span>Preserves Opaqueness</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="settingAnimated" />
                  <span>Animated</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="settingUsesDepth" />
                  <span>Uses Depth</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="settingMustPredraw" />
                  <span>Must Predraw</span>
                </label>
                <label class="checkbox-label">
                  <input
                    type="checkbox"
                    id="settingSupports3DDirectRendering"
                  />
                  <span>Supports 3D Direct Rendering</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="settingIsDeprecated" />
                  <span>Is Deprecated</span>
                </label>
                <label>
                  <span>Extend Box</span>
                  <div class="extend-box-inputs">
                    <input
                      type="number"
                      id="settingExtendBoxH"
                      placeholder="H"
                      step="0.1"
                    />
                    <input
                      type="number"
                      id="settingExtendBoxV"
                      placeholder="V"
                      step="0.1"
                    />
                  </div>
                </label>
              </div>
            </div>
          </div>
          <div id="uniforms-section" class="collapsible-section">
            <div class="sidebar-section-header">
              <h2>Uniforms</h2>
              <button class="collapse-btn">▼</button>
            </div>
            <div class="sidebar-section-content">
              <button id="addUniformBtn" class="add-uniform-btn">
                + Add Uniform
              </button>
              <div id="uniform-list"></div>
            </div>
          </div>
          <div id="custom-nodes-section" class="collapsible-section">
            <div class="sidebar-section-header">
              <h2>Custom Nodes</h2>
              <button class="collapse-btn">▼</button>
            </div>
            <div class="sidebar-section-content">
              <button id="addCustomNodeBtn" class="add-uniform-btn">
                + Create Custom Node
              </button>
              <div id="custom-nodes-list" class="custom-nodes-list"></div>
            </div>
          </div>
        </div>
        <div id="canvas-container">
          <canvas id="canvas"></canvas>
          <div id="minimap-container">
            <canvas id="minimap"></canvas>
            <div id="minimap-controls">
              <button
                id="zoomInBtn"
                class="minimap-control-btn"
                title="Zoom In"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path
                    d="M9,2A7,7 0 0,1 16,9C16,10.57 15.5,12 14.61,13.19L15.41,14H16L22,20L20,22L14,16V15.41L13.19,14.61C12,15.5 10.57,16 9,16A7,7 0 0,1 2,9A7,7 0 0,1 9,2M8,5V8H5V10H8V13H10V10H13V8H10V5H8Z"
                  />
                </svg>
              </button>
              <button
                id="zoomOutBtn"
                class="minimap-control-btn"
                title="Zoom Out"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path
                    d="M9,2A7,7 0 0,1 16,9C16,10.57 15.5,12 14.61,13.19L15.41,14H16L22,20L20,22L14,16V15.41L13.19,14.61C12,15.5 10.57,16 9,16A7,7 0 0,1 2,9A7,7 0 0,1 9,2M5,8V10H13V8H5Z"
                  />
                </svg>
              </button>
              <button
                id="resetZoomBtn"
                class="minimap-control-btn"
                title="Reset Zoom (100%)"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path
                    d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"
                  />
                </svg>
              </button>

              <button
                id="zoomToFitBtn"
                class="minimap-control-btn"
                title="Zoom to Fit"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path
                    d="M12 8C8.44 8 6.65 12.31 9.17 14.83C11.69 17.35 16 15.56 16 12C16 9.79 14.21 8 12 8M5 15H3V19C3 20.1 3.9 21 5 21H9V19H5M5 5H9V3H5C3.9 3 3 3.9 3 5V9H5M19 3H15V5H19V9H21V5C21 3.9 20.1 3 19 3M19 19H15V21H19C20.1 21 21 20.1 21 19V15H19"
                  />
                </svg>
              </button>
              <button
                id="centerViewBtn"
                class="minimap-control-btn"
                title="Center View"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path
                    d="M19.5,3.09L20.91,4.5L16.41,9H20V11H13V4H15V7.59L19.5,3.09M20.91,19.5L19.5,20.91L15,16.41V20H13V13H20V15H16.41L20.91,19.5M4.5,3.09L9,7.59V4H11V11H4V9H7.59L3.09,4.5L4.5,3.09M3.09,19.5L7.59,15H4V13H11V20H9V16.41L4.5,20.91L3.09,19.5Z"
                  />
                </svg>
              </button>
              <div
                id="zoomLevelDisplay"
                class="zoom-level-display"
                title="Current Zoom Level"
              >
                100%
              </div>
            </div>
          </div>
        </div>
        <div id="sidebar">
          <div id="sidebar-header">
            <h2>Execution Order</h2>
            <button id="closeSidebarBtn">×</button>
          </div>
          <div id="sidebar-content">
            <p id="no-output-msg">No output node found</p>
            <div id="dependency-list"></div>
          </div>
        </div>
      </div>
    </div>
    <div id="searchMenu" class="search-menu">
      <input type="text" id="searchInput" placeholder="Search nodes..." />
      <div id="searchResults" class="search-results"></div>
    </div>
    <div id="customNodeModal" class="custom-node-modal">
      <div class="custom-node-modal-content">
        <h3>Custom Node</h3>
        <div class="custom-node-form">
          <label>
            <span>Node Name</span>
            <input
              type="text"
              id="customNodeName"
              placeholder="My Custom Node"
            />
          </label>

          <label>
            <span>Node Color</span>
            <input type="color" id="customNodeColor" value="#9b59b6" />
          </label>

          <div class="custom-node-section">
            <h4>Inputs</h4>
            <div id="customNodeInputs"></div>
            <button id="addCustomInput" class="add-port-btn">
              + Add Input
            </button>
          </div>

          <div class="custom-node-section">
            <h4>Outputs</h4>
            <div id="customNodeOutputs"></div>
            <button id="addCustomOutput" class="add-port-btn">
              + Add Output
            </button>
          </div>

          <div class="custom-node-section">
            <h4>WebGL 1 Code</h4>
            <label>
              <span>Dependency (functions, outside main)</span>
              <textarea
                id="customNodeWebGL1Dep"
                rows="3"
                placeholder="// Optional: functions, uniforms, etc."
              ></textarea>
            </label>
            <label>
              <span>Execution (inside main)</span>
              <textarea
                id="customNodeWebGL1Exec"
                rows="4"
                placeholder="// Use {input0}, {input1}, etc. for inputs&#10;// Use {output0}, {output1}, etc. for outputs&#10;float {output0} = {input0} + {input1};"
              ></textarea>
            </label>
          </div>

          <div class="custom-node-section">
            <h4>WebGL 2 Code</h4>
            <label>
              <span>Dependency</span>
              <textarea
                id="customNodeWebGL2Dep"
                rows="3"
                placeholder="// Optional: functions, uniforms, etc."
              ></textarea>
            </label>
            <label>
              <span>Execution</span>
              <textarea
                id="customNodeWebGL2Exec"
                rows="4"
                placeholder="float {output0} = {input0} + {input1};"
              ></textarea>
            </label>
          </div>

          <div class="custom-node-section">
            <h4>WebGPU Code</h4>
            <label>
              <span>Dependency</span>
              <textarea
                id="customNodeWebGPUDep"
                rows="3"
                placeholder="// Optional: functions, etc."
              ></textarea>
            </label>
            <label>
              <span>Execution</span>
              <textarea
                id="customNodeWebGPUExec"
                rows="4"
                placeholder="var {output0}: f32 = {input0} + {input1};"
              ></textarea>
            </label>
          </div>

          <div class="custom-node-modal-buttons">
            <button id="saveCustomNode" class="primary-btn">Save</button>
            <button id="cancelCustomNode" class="secondary-btn">Cancel</button>
          </div>
        </div>
      </div>
    </div>
    <div id="uniformModal" class="uniform-modal">
      <div class="uniform-modal-content">
        <h3>Add Uniform</h3>
        <label>
          Name:
          <input type="text" id="uniformNameInput" placeholder="My Uniform" />
        </label>
        <label>
          Description:
          <input
            type="text"
            id="uniformDescriptionInput"
            placeholder="Optional description"
          />
        </label>
        <label>
          Type:
          <select id="uniformTypeSelect">
            <option value="float">Float</option>
            <option value="color">Color (Vec3)</option>
          </select>
        </label>
        <div class="uniform-modal-buttons">
          <button id="uniformModalCancel">Cancel</button>
          <button id="uniformModalAdd">Add</button>
        </div>
      </div>
    </div>

    <!-- View Code Modal -->
    <div id="viewCodeModal" class="modal" style="display: none">
      <div class="modal-content view-code-modal">
        <div class="modal-header">
          <h2>Generated Shader Code</h2>
          <button class="modal-close" id="viewCodeModalClose">×</button>
        </div>
        <div class="modal-body">
          <div class="code-tabs">
            <button class="code-tab active" data-target="webgl1">
              WebGL 1
            </button>
            <button class="code-tab" data-target="webgl2">WebGL 2</button>
            <button class="code-tab" data-target="webgpu">WebGPU</button>
          </div>
          <div class="code-panels">
            <div class="code-panel active" id="code-webgl1">
              <pre><code id="code-webgl1-content"></code></pre>
            </div>
            <div class="code-panel" id="code-webgl2">
              <pre><code id="code-webgl2-content"></code></pre>
            </div>
            <div class="code-panel" id="code-webgpu">
              <pre><code id="code-webgpu-content"></code></pre>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="copyCodeBtn">Copy Current</button>
          <button id="viewCodeModalOk">Close</button>
        </div>
      </div>
    </div>

    <script type="module" src="script.js"></script>
  </body>
</html>

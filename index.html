<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CAW Shader</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="CAW Shader" />
    <link rel="manifest" href="/site.webmanifest" />
    <script type="module"></script>
  </head>
  <body>
    <div id="app">
      <div id="toolbar">
        <div class="toolbar-section toolbar-branding">
          <img src="/favicon.svg" alt="Logo" class="toolbar-logo" />
          <h1>CAW Shader</h1>
          <select
            id="languageSelect"
            class="language-select"
            title="Language"
            style="/*display: none*/"
          >
            <option value="en-US">English</option>
            <option value="fr-FR">Français</option>
            <option value="zh-CN">简体中文</option>
          </select>
        </div>
        <div class="toolbar-section toolbar-menus">
          <!-- File Menu -->
          <div class="toolbar-menu">
            <button class="toolbar-menu-btn">File</button>
            <div class="toolbar-dropdown">
              <button id="newBtn" class="dropdown-item" data-action="new">
                <span class="dropdown-item-label">New</span>
                <span class="dropdown-item-shortcut">Ctrl+N</span>
              </button>
              <button id="loadBtn" class="dropdown-item" data-action="open">
                <span class="dropdown-item-label">Open</span>
                <span class="dropdown-item-shortcut">Ctrl+O</span>
              </button>
              <button id="saveBtn" class="dropdown-item" data-action="save">
                <span class="dropdown-item-label">Save</span>
                <span class="dropdown-item-shortcut">Ctrl+S</span>
              </button>
              <button id="saveAsBtn" class="dropdown-item" data-action="saveAs">
                <span class="dropdown-item-label">Save As</span>
                <span class="dropdown-item-shortcut">Ctrl+Shift+S</span>
              </button>
              <div class="dropdown-separator"></div>
              <button
                id="examplesBtn"
                class="dropdown-item"
                data-action="examples"
              >
                <span class="dropdown-item-label">Examples</span>
              </button>
            </div>
          </div>

          <!-- Edit Menu -->
          <div class="toolbar-menu">
            <button class="toolbar-menu-btn">Edit</button>
            <div class="toolbar-dropdown">
              <button id="undoBtn" class="dropdown-item" data-action="undo">
                <span class="dropdown-item-label">Undo</span>
                <span class="dropdown-item-shortcut">Ctrl+Z</span>
              </button>
              <button id="redoBtn" class="dropdown-item" data-action="redo">
                <span class="dropdown-item-label">Redo</span>
                <span class="dropdown-item-shortcut">Ctrl+Y</span>
              </button>
              <div class="dropdown-separator"></div>
              <button
                id="selectAllBtn"
                class="dropdown-item"
                data-action="selectAll"
              >
                <span class="dropdown-item-label">Select All</span>
                <span class="dropdown-item-shortcut">Ctrl+A</span>
              </button>
              <button
                id="clearSelectionBtn"
                class="dropdown-item"
                data-action="clearSelection"
              >
                <span class="dropdown-item-label">Clear Selection</span>
                <span class="dropdown-item-shortcut">Esc</span>
              </button>
              <div class="dropdown-separator"></div>
              <button id="copyBtn" class="dropdown-item" data-action="copy">
                <span class="dropdown-item-label">Copy</span>
                <span class="dropdown-item-shortcut">Ctrl+C</span>
              </button>
              <button id="pasteBtn" class="dropdown-item" data-action="paste">
                <span class="dropdown-item-label">Paste</span>
                <span class="dropdown-item-shortcut">Ctrl+V</span>
              </button>
              <button id="deleteBtn" class="dropdown-item" data-action="delete">
                <span class="dropdown-item-label">Delete</span>
                <span class="dropdown-item-shortcut">Del</span>
              </button>
              <button
                id="duplicateBtn"
                class="dropdown-item"
                data-action="duplicate"
              >
                <span class="dropdown-item-label">Duplicate</span>
                <span class="dropdown-item-shortcut">Ctrl+D</span>
              </button>
              <div class="dropdown-separator"></div>
              <button
                id="previewNodeBtn"
                class="dropdown-item"
                data-action="previewNode"
              >
                <span class="dropdown-item-label">Preview Node</span>
                <span class="dropdown-item-shortcut">L</span>
              </button>
              <button
                id="clearNodePreviewBtn"
                class="dropdown-item"
                data-action="clearNodePreview"
              >
                <span class="dropdown-item-label">Clear Node Preview</span>
              </button>
            </div>
          </div>

          <!-- View Menu -->
          <div class="toolbar-menu">
            <button class="toolbar-menu-btn">View</button>
            <div class="toolbar-dropdown">
              <button
                id="zoomInMenuBtn"
                class="dropdown-item"
                data-action="zoomIn"
              >
                <span class="dropdown-item-label">Zoom In</span>
                <span class="dropdown-item-shortcut">Ctrl++</span>
              </button>
              <button
                id="zoomOutMenuBtn"
                class="dropdown-item"
                data-action="zoomOut"
              >
                <span class="dropdown-item-label">Zoom Out</span>
                <span class="dropdown-item-shortcut">Ctrl+-</span>
              </button>
              <button
                id="resetZoomMenuBtn"
                class="dropdown-item"
                data-action="resetZoom"
              >
                <span class="dropdown-item-label">Reset Zoom</span>
                <span class="dropdown-item-shortcut">Ctrl+0</span>
              </button>
              <button
                id="zoomToFitMenuBtn"
                class="dropdown-item"
                data-action="zoomToFit"
              >
                <span class="dropdown-item-label">Zoom to Fit</span>
                <span class="dropdown-item-shortcut">Shift+F</span>
              </button>
              <button
                id="centerViewMenuBtn"
                class="dropdown-item"
                data-action="centerView"
              >
                <span class="dropdown-item-label">Center View</span>
                <span class="dropdown-item-shortcut">F</span>
              </button>
              <div class="dropdown-separator"></div>
              <button
                id="togglePreviewBtn"
                class="dropdown-item"
                data-action="togglePreview"
              >
                <span class="dropdown-item-label">Hide Preview</span>
                <span class="dropdown-item-shortcut">P</span>
              </button>
              <button
                id="reloadPreviewMenuBtn"
                class="dropdown-item"
                data-action="reloadPreview"
              >
                <span class="dropdown-item-label">Reload Preview</span>
                <span class="dropdown-item-shortcut">R</span>
              </button>
              <button
                id="resetPreviewPositionBtn"
                class="dropdown-item"
                data-action="resetPreviewPosition"
              >
                <span class="dropdown-item-label">Reset Preview Position</span>
                <span class="dropdown-item-shortcut">Shift+P</span>
              </button>
            </div>
          </div>

          <!-- Project Menu -->
          <div class="toolbar-menu">
            <button class="toolbar-menu-btn">Project</button>
            <div class="toolbar-dropdown">
              <button
                id="autoArrangeBtn"
                class="dropdown-item"
                data-action="autoArrange"
              >
                <span class="dropdown-item-label">Auto Arrange Nodes</span>
                <span class="dropdown-item-shortcut">Ctrl+L</span>
              </button>
              <button
                id="viewCodeBtn"
                class="dropdown-item"
                data-action="viewCode"
              >
                <span class="dropdown-item-label">View Code</span>
              </button>
            </div>
          </div>

          <!-- Help Menu -->
          <div class="toolbar-menu">
            <button class="toolbar-menu-btn">Help</button>
            <div class="toolbar-dropdown toolbar-dropdown-help">
              <div class="help-search-container">
                <svg
                  class="help-search-icon"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                >
                  <path
                    d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"
                  />
                </svg>
                <input
                  type="text"
                  id="helpSearchInput"
                  class="help-search-input"
                  placeholder="Search menus..."
                />
              </div>
              <div class="help-search-results" id="helpSearchResults"></div>
              <div class="help-menu-items">
                <button
                  id="reportIssueBtn"
                  class="dropdown-item dropdown-item-warning"
                  data-action="reportIssue"
                >
                  <span class="dropdown-item-label">Report Issue</span>
                </button>
                <button
                  id="githubBtn"
                  class="dropdown-item"
                  data-action="viewSource"
                >
                  <span class="dropdown-item-label">View Source Code</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Standalone buttons -->
        <div class="toolbar-section toolbar-standalone">
          <button
            id="exportBtn"
            class="toolbar-btn toolbar-btn-primary"
            title="Export Addon"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path
                d="M23,12L19,8V11H10V13H19V16M1,18V6C1,4.89 1.9,4 3,4H15A2,2 0 0,1 17,6V9H15V6H3V18H15V15H17V18A2,2 0 0,1 15,20H3A2,2 0 0,1 1,18Z"
              />
            </svg>
            <span>Export</span>
          </button>
        </div>
      </div>
      <input
        type="file"
        id="loadFileInput"
        accept=".c3sg,.json"
        style="display: none"
      />
      <div id="main-content">
        <div id="shader-errors-container"></div>
        <button id="openPreviewBtn" title="Open Preview" style="display: none">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <title>eye</title>
            <path
              d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"
            />
          </svg>
        </button>
        <div id="preview-window">
          <div id="preview-header">
            <span>Preview</span>
            <div class="preview-header-buttons">
              <button id="togglePreviewSettingsBtn" title="Toggle Settings">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <title>tune-variant</title>
                  <path
                    d="M8 13C6.14 13 4.59 14.28 4.14 16H2V18H4.14C4.59 19.72 6.14 21 8 21S11.41 19.72 11.86 18H22V16H11.86C11.41 14.28 9.86 13 8 13M8 19C6.9 19 6 18.1 6 17C6 15.9 6.9 15 8 15S10 15.9 10 17C10 18.1 9.1 19 8 19M19.86 6C19.41 4.28 17.86 3 16 3S12.59 4.28 12.14 6H2V8H12.14C12.59 9.72 14.14 11 16 11S19.41 9.72 19.86 8H22V6H19.86M16 9C14.9 9 14 8.1 14 7C14 5.9 14.9 5 16 5S18 5.9 18 7C18 8.1 17.1 9 16 9Z"
                  />
                </svg>
              </button>
              <button id="reloadPreviewBtn" title="Reload Preview">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <title>refresh</title>
                  <path
                    d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"
                  />
                </svg>
              </button>
              <button id="screenshotPreviewBtn" title="Screenshot Preview">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <title>camera</title>
                  <path
                    d="M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z"
                  />
                </svg>
              </button>
              <button id="closePreviewBtn" title="Close Preview">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <title>window-close</title>
                  <path
                    d="M13.46,12L19,17.54V19H17.54L12,13.46L6.46,19H5V17.54L10.54,12L5,6.46V5H6.46L12,10.54L17.54,5H19V6.46L13.46,12Z"
                  />
                </svg>
              </button>
            </div>
          </div>
          <div id="preview-content">
            <div id="preview-controls" class="preview-controls-hidden">
              <div class="preview-control-group">
                <label>Effect Target:</label>
                <select id="effectTargetSelect">
                  <option value="sprite">Sprite</option>
                  <option value="shape3D">3D Shape</option>
                  <option value="layout">Layout</option>
                  <option value="layer">Layer</option>
                </select>
              </div>
              <div class="preview-control-group">
                <label>Object:</label>
                <select id="objectSelect">
                  <option value="sprite">Sprite</option>
                  <option value="box">Box</option>
                  <option value="prism">Prism</option>
                  <option value="wedge">Wedge</option>
                  <option value="pyramid">Pyramid</option>
                  <option value="corner-out">Corner Out</option>
                  <option value="corner-in">Corner In</option>
                </select>
              </div>
              <div class="preview-control-group">
                <label>Camera:</label>
                <select id="cameraModeSelect">
                  <option value="2d">2D</option>
                  <option value="perspective">Perspective</option>
                  <option value="orthographic">Orthographic</option>
                </select>
              </div>
              <div class="preview-control-group" id="autoRotateGroup">
                <label>
                  <input type="checkbox" id="autoRotateCheckbox" checked />
                  Auto Rotate
                </label>
              </div>
              <div class="preview-control-group">
                <label>Sampling:</label>
                <select id="samplingModeSelect">
                  <option value="trilinear">Trilinear</option>
                  <option value="bilinear">Bilinear</option>
                  <option value="nearest">Nearest</option>
                </select>
              </div>
              <div class="preview-control-group">
                <label>Shader Language:</label>
                <select id="shaderLanguageSelect">
                  <option value="webgpu">WebGPU</option>
                  <option value="webgl2">WebGL 2</option>
                  <option value="webgl1">WebGL 1</option>
                </select>
              </div>
              <div class="preview-control-group preview-texture-group">
                <label>Sprite Texture:</label>
                <div class="texture-preview-container">
                  <div id="spriteTexturePreview" class="texture-preview">
                    <span>No image</span>
                  </div>
                  <input
                    type="file"
                    id="spriteTextureInput"
                    accept="image/*"
                    style="display: none"
                  />
                  <button
                    id="spriteTextureBtn"
                    class="texture-btn"
                    title="Load sprite texture"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                      <path
                        d="M5 3H19C20.11 3 21 3.9 21 5V19C21 20.11 20.11 21 19 21H5C3.9 21 3 20.11 3 19V5C3 3.9 3.9 3 5 3M16 17V15H8V17H16M16 11L12 7L8 11H10.5V14H13.5V11H16Z"
                      />
                    </svg>
                  </button>
                  <button
                    id="clearSpriteTextureBtn"
                    class="texture-clear-btn"
                    title="Clear sprite texture"
                    style="display: none"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                      <path
                        d="M22,3H7C6.31,3 5.77,3.35 5.41,3.88L0,12L5.41,20.11C5.77,20.64 6.31,21 7,21H22A2,2 0 0,0 24,19V5A2,2 0 0,0 22,3M19,15.59L17.59,17L14,13.41L10.41,17L9,15.59L12.59,12L9,8.41L10.41,7L14,10.59L17.59,7L19,8.41L15.41,12"
                      />
                    </svg>
                  </button>
                </div>
              </div>
              <div class="preview-control-group preview-texture-group">
                <label>Shape Texture:</label>
                <div class="texture-preview-container">
                  <div id="shapeTexturePreview" class="texture-preview">
                    <span>No image</span>
                  </div>
                  <input
                    type="file"
                    id="shapeTextureInput"
                    accept="image/*"
                    style="display: none"
                  />
                  <button
                    id="shapeTextureBtn"
                    class="texture-btn"
                    title="Load shape texture"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                      <path
                        d="M5 3H19C20.11 3 21 3.9 21 5V19C21 20.11 20.11 21 19 21H5C3.9 21 3 20.11 3 19V5C3 3.9 3.9 3 5 3M16 17V15H8V17H16M16 11L12 7L8 11H10.5V14H13.5V11H16Z"
                      />
                    </svg>
                  </button>
                  <button
                    id="clearShapeTextureBtn"
                    class="texture-clear-btn"
                    title="Clear shape texture"
                    style="display: none"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                      <path
                        d="M22,3H7C6.31,3 5.77,3.35 5.41,3.88L0,12L5.41,20.11C5.77,20.64 6.31,21 7,21H22A2,2 0 0,0 24,19V5A2,2 0 0,0 22,3M19,15.59L17.59,17L14,13.41L10.41,17L9,15.59L12.59,12L9,8.41L10.41,7L14,10.59L17.59,7L19,8.41L15.41,12"
                      />
                    </svg>
                  </button>
                </div>
              </div>
              <div class="preview-control-group">
                <button id="resetPreviewSettingsBtn" class="reset-preview-btn">
                  Reset Preview Settings
                </button>
              </div>
            </div>
            <iframe id="preview-iframe" src="./preview/index.html"></iframe>
          </div>
        </div>
        <div id="uniform-sidebar">
          <div id="shader-settings-section" class="collapsible-section">
            <div class="sidebar-section-header">
              <h2>Shader Info</h2>
              <button class="collapse-btn">▼</button>
            </div>
            <div class="sidebar-section-content">
              <div class="settings-form">
                <label>
                  <span>Name</span>
                  <input type="text" id="settingName" placeholder="My Effect" />
                </label>
                <label>
                  <span>Version</span>
                  <input
                    type="text"
                    id="settingVersion"
                    placeholder="1.0.0.0"
                  />
                </label>
                <label>
                  <span>Author</span>
                  <input
                    type="text"
                    id="settingAuthor"
                    placeholder="Author name"
                  />
                </label>

                <label>
                  <span>Category</span>
                  <select id="settingCategory">
                    <option value="3d">3D</option>
                    <option value="blend">Blend</option>
                    <option value="color" selected>Color</option>
                    <option value="distortion">Distortion</option>
                    <option value="mask">Mask</option>
                    <option value="normal-mapping">Normal Mapping</option>
                    <option value="tiling">Tiling</option>
                    <option value="other">Other</option>
                  </select>
                </label>
                <label>
                  <span>Website</span>
                  <input
                    type="url"
                    id="settingWebsite"
                    placeholder="https://example.com"
                  />
                </label>
                <label>
                  <span>Docs</span>
                  <input
                    type="url"
                    id="settingDocumentation"
                    placeholder="https://docs.example.com"
                  />
                </label>
                <label>
                  <span>Description</span>
                  <textarea
                    id="settingDescription"
                    rows="3"
                    placeholder="Shader description..."
                  ></textarea>
                </label>
              </div>
            </div>
          </div>
          <div id="shader-settings-section" class="collapsible-section">
            <div class="sidebar-section-header">
              <h2>Shader Settings</h2>
              <button class="collapse-btn">▼</button>
            </div>
            <div class="sidebar-section-content">
              <div class="settings-form">
                <label class="checkbox-label">
                  <input type="checkbox" id="settingBlendsBackground" />
                  <span>Blends Background</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="settingCrossSampling" />
                  <span>Cross Sampling</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="settingPreservesOpaqueness" />
                  <span>Preserves Opaqueness</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="settingAnimated" />
                  <span>Animated</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="settingUsesDepth" />
                  <span>Uses Depth</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="settingMustPredraw" />
                  <span>Must Predraw</span>
                </label>
                <label class="checkbox-label">
                  <input
                    type="checkbox"
                    id="settingSupports3DDirectRendering"
                  />
                  <span>Supports 3D Direct Rendering</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="settingIsDeprecated" />
                  <span>Is Deprecated</span>
                </label>
                <label>
                  <span>Extend Box</span>
                  <div class="extend-box-inputs">
                    <input
                      type="number"
                      id="settingExtendBoxH"
                      placeholder="H"
                      step="0.1"
                    />
                    <input
                      type="number"
                      id="settingExtendBoxV"
                      placeholder="V"
                      step="0.1"
                    />
                  </div>
                </label>
              </div>
            </div>
          </div>
          <div id="uniforms-section" class="collapsible-section">
            <div class="sidebar-section-header">
              <h2>Uniforms</h2>
              <button class="collapse-btn">▼</button>
            </div>
            <div class="sidebar-section-content">
              <button id="addUniformBtn" class="add-uniform-btn">
                + Add Uniform
              </button>
              <div id="uniform-list"></div>
            </div>
          </div>
          <div id="custom-nodes-section" class="collapsible-section">
            <div class="sidebar-section-header">
              <h2>Custom Nodes</h2>
              <button class="collapse-btn">▼</button>
            </div>
            <div class="sidebar-section-content">
              <button id="addCustomNodeBtn" class="add-uniform-btn">
                + Create Custom Node
              </button>
              <div id="custom-nodes-list" class="custom-nodes-list"></div>
            </div>
          </div>
        </div>
        <div id="canvas-container">
          <canvas id="canvas"></canvas>
          <div id="minimap-container">
            <canvas id="minimap"></canvas>
            <div id="minimap-controls">
              <button
                id="zoomInBtn"
                class="minimap-control-btn"
                title="Zoom In"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path
                    d="M9,2A7,7 0 0,1 16,9C16,10.57 15.5,12 14.61,13.19L15.41,14H16L22,20L20,22L14,16V15.41L13.19,14.61C12,15.5 10.57,16 9,16A7,7 0 0,1 2,9A7,7 0 0,1 9,2M8,5V8H5V10H8V13H10V10H13V8H10V5H8Z"
                  />
                </svg>
              </button>
              <button
                id="zoomOutBtn"
                class="minimap-control-btn"
                title="Zoom Out"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path
                    d="M9,2A7,7 0 0,1 16,9C16,10.57 15.5,12 14.61,13.19L15.41,14H16L22,20L20,22L14,16V15.41L13.19,14.61C12,15.5 10.57,16 9,16A7,7 0 0,1 2,9A7,7 0 0,1 9,2M5,8V10H13V8H5Z"
                  />
                </svg>
              </button>
              <button
                id="resetZoomBtn"
                class="minimap-control-btn"
                title="Reset Zoom (100%)"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path
                    d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"
                  />
                </svg>
              </button>

              <button
                id="zoomToFitBtn"
                class="minimap-control-btn"
                title="Zoom to Fit"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path
                    d="M12 8C8.44 8 6.65 12.31 9.17 14.83C11.69 17.35 16 15.56 16 12C16 9.79 14.21 8 12 8M5 15H3V19C3 20.1 3.9 21 5 21H9V19H5M5 5H9V3H5C3.9 3 3 3.9 3 5V9H5M19 3H15V5H19V9H21V5C21 3.9 20.1 3 19 3M19 19H15V21H19C20.1 21 21 20.1 21 19V15H19"
                  />
                </svg>
              </button>
              <button
                id="centerViewBtn"
                class="minimap-control-btn"
                title="Center View"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path
                    d="M19.5,3.09L20.91,4.5L16.41,9H20V11H13V4H15V7.59L19.5,3.09M20.91,19.5L19.5,20.91L15,16.41V20H13V13H20V15H16.41L20.91,19.5M4.5,3.09L9,7.59V4H11V11H4V9H7.59L3.09,4.5L4.5,3.09M3.09,19.5L7.59,15H4V13H11V20H9V16.41L4.5,20.91L3.09,19.5Z"
                  />
                </svg>
              </button>
              <div
                id="zoomLevelDisplay"
                class="zoom-level-display"
                title="Current Zoom Level"
              >
                100%
              </div>
            </div>
          </div>
        </div>
        <div id="sidebar">
          <div id="sidebar-header">
            <h2>Execution Order</h2>
            <button id="closeSidebarBtn">×</button>
          </div>
          <div id="sidebar-content">
            <p id="no-output-msg">No output node found</p>
            <div id="dependency-list"></div>
          </div>
        </div>
      </div>
    </div>
    <div id="searchMenu" class="search-menu">
      <input type="text" id="searchInput" placeholder="Search nodes..." />
      <div id="searchResults" class="search-results"></div>
    </div>
    <div id="customNodeModal" class="custom-node-modal">
      <div class="custom-node-modal-content">
        <h3>Custom Node</h3>
        <div class="custom-node-form">
          <!-- Header Section -->
          <div class="custom-node-header">
            <div class="custom-node-header-row">
              <label class="name-label">
                <span>Custom Node Name</span>
                <input
                  type="text"
                  id="customNodeName"
                  placeholder="My Custom Node"
                />
              </label>
              <label class="color-label">
                <span></span>
                <input type="color" id="customNodeColor" value="#9b59b6" />
              </label>
              <label class="checkbox-label">
                <input type="checkbox" id="customNodeSplitWebGL" checked />
                <span>split webgl</span>
              </label>
            </div>

            <div class="custom-node-header-row">
              <div class="custom-node-ports-section">
                <div class="custom-node-ports-column">
                  <div class="custom-node-ports-header">
                    <h4>Inputs</h4>
                    <button id="addCustomInput" class="add-port-btn-small">
                      +
                    </button>
                  </div>
                  <div
                    id="customNodeInputs"
                    class="custom-node-ports-list"
                  ></div>
                </div>
                <div class="custom-node-ports-column">
                  <div class="custom-node-ports-header">
                    <h4>Outputs</h4>
                    <button id="addCustomOutput" class="add-port-btn-small">
                      +
                    </button>
                  </div>
                  <div
                    id="customNodeOutputs"
                    class="custom-node-ports-list"
                  ></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Code Editor Section -->
          <div class="custom-node-code-section">
            <div class="custom-node-code-header">
              <div class="code-type-tabs">
                <button class="code-tab active" data-code-type="dependency">
                  Dependency
                </button>
                <button class="code-tab" data-code-type="execution">
                  Execution
                </button>
              </div>
              <div class="shader-lang-tabs">
                <button class="shader-tab active" data-shader="webgl1">
                  WebGL 1
                </button>
                <button class="shader-tab" data-shader="webgl2">WebGL 2</button>
                <button class="shader-tab" data-shader="webgpu">WebGPU</button>
              </div>
            </div>
            <div class="custom-node-code-editor">
              <div id="customNodeCodeEditor"></div>
            </div>
          </div>

          <div class="custom-node-modal-buttons">
            <button id="saveCustomNode" class="primary-btn">Save</button>
            <button id="cancelCustomNode" class="secondary-btn">Cancel</button>
          </div>
        </div>
      </div>
    </div>
    <div id="uniformModal" class="uniform-modal">
      <div class="uniform-modal-content">
        <h3>Add Uniform</h3>
        <label>
          Name:
          <input type="text" id="uniformNameInput" placeholder="My Uniform" />
        </label>
        <label>
          Description:
          <input
            type="text"
            id="uniformDescriptionInput"
            placeholder="Optional description"
          />
        </label>
        <label>
          Type:
          <select id="uniformTypeSelect">
            <option value="float">Float</option>
            <option value="color">Color (Vec3)</option>
          </select>
        </label>
        <div class="uniform-modal-buttons">
          <button id="uniformModalCancel">Cancel</button>
          <button id="uniformModalAdd">Add</button>
        </div>
      </div>
    </div>

    <!-- View Code Modal -->
    <div id="viewCodeModal" class="modal" style="display: none">
      <div class="modal-content view-code-modal">
        <div class="modal-header">
          <h2>Generated Shader Code</h2>
          <button class="modal-close" id="viewCodeModalClose">×</button>
        </div>
        <div class="modal-body">
          <div class="code-tabs">
            <button class="code-tab active" data-target="webgl1">
              WebGL 1
            </button>
            <button class="code-tab" data-target="webgl2">WebGL 2</button>
            <button class="code-tab" data-target="webgpu">WebGPU</button>
          </div>
          <div class="code-panels">
            <div class="code-panel active" id="code-webgl1"></div>
            <div class="code-panel" id="code-webgl2"></div>
            <div class="code-panel" id="code-webgpu"></div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="copyCodeBtn">Copy Current</button>
          <button id="viewCodeModalOk">Close</button>
        </div>
      </div>
    </div>

    <!-- Open Files Modal (Combined Recent Files and Examples) -->
    <div id="openFilesModal" class="modal" style="display: none">
      <div class="modal-content open-files-modal">
        <div class="modal-header">
          <h2>Open Shader</h2>
          <button class="modal-close" id="openFilesModalClose">×</button>
        </div>
        <div class="modal-tabs">
          <button class="modal-tab active" data-tab="recent">
            Recent Files
          </button>
          <button class="modal-tab" data-tab="examples">Examples</button>
        </div>
        <div class="modal-body">
          <!-- Recent Files Tab -->
          <div class="modal-tab-content active" id="recentFilesTab">
            <div class="recent-files-grid" id="recentFilesGrid">
              <!-- Recent files will be populated here -->
            </div>
            <div
              class="recent-files-empty"
              id="recentFilesEmpty"
              style="display: none"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                width="64"
                height="64"
                style="opacity: 0.3; margin-bottom: 16px"
              >
                <path
                  fill="currentColor"
                  d="M13,9V3.5L18.5,9M6,2C4.89,2 4,2.89 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6Z"
                />
              </svg>
              <p>No recent files</p>
              <p style="font-size: 13px; color: #888; margin-top: 8px">
                Open or create a file to get started
              </p>
            </div>
          </div>
          <!-- Examples Tab -->
          <div class="modal-tab-content" id="examplesTab">
            <div class="examples-grid" id="examplesGrid">
              <!-- Examples will be populated here -->
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button
            id="clearRecentFilesBtn"
            class="link-btn"
            style="margin-right: auto"
          >
            Clear Recent Files
          </button>
          <button id="openFilesNewBtn" class="primary-btn">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              width="18"
              height="18"
            >
              <path
                fill="currentColor"
                d="M13,9V3.5L18.5,9M6,2C4.89,2 4,2.89 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6Z"
              />
            </svg>
            New File
          </button>
          <button id="openFilesOpenBtn" class="primary-btn">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              width="18"
              height="18"
            >
              <path
                fill="currentColor"
                d="M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z"
              />
            </svg>
            Open File
          </button>
          <button id="openFilesModalCancel">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Comment Edit Modal -->
    <div id="commentModal" class="uniform-modal">
      <div class="uniform-modal-content">
        <h3>Edit Comment</h3>
        <label>
          Title:
          <input type="text" id="commentTitleInput" placeholder="Comment" />
        </label>
        <label>
          Description:
          <textarea
            id="commentDescriptionInput"
            rows="4"
            placeholder="Optional description"
          ></textarea>
        </label>
        <label style="pointer-events: none">
          <div class="color-input-label">Color:</div>
          <div class="color-input-wrapper">
            <input type="color" id="commentColorInput" value="#4a90e2" />
            <input
              type="text"
              id="commentColorText"
              value="#4a90e2"
              maxlength="7"
              placeholder="#4a90e2"
            />
          </div>
        </label>
        <div class="uniform-modal-buttons">
          <button id="commentModalCancel">Cancel</button>
          <button id="commentModalSave">Save</button>
        </div>
      </div>
    </div>

    <script type="module" src="script.js"></script>
  </body>
</html>
